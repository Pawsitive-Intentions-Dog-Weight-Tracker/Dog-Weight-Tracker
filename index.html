<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dog Weight Tracker</title>
  <meta name="theme-color" content="#0f766e" />
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" type="image/png" href="icons/favicon-64.png">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon-180.png">
</head>
<body>

  <!-- Brand header with green icon -->
  <header class="brandHeader">
    <img src="icons/icon-green-512.png" alt="" class="brandLogo">
    <div class="brandText">
      <h1>Dog Weight Tracker</h1>
      <p class="subtitle">Works offline • Exports CSV • No login required</p>
    </div>
  </header>

  <main>

    <!-- TOP: Profile photo card -->
    <section class="card" id="profileCard">
      <div style="display:flex;align-items:center;justify-content:center;gap:12px;margin:4px 0 6px;">
        <img
          id="profileImg"
          alt="Profile"
          class="profileImgLg"
          role="button"
          tabindex="0"
          aria-label="Change profile photo"
        />
        <input id="profileFile" type="file" accept="image/*" hidden>
        <button id="profileClearBtn" type="button">Remove photo</button>
      </div>
      <p id="profileDogName" class="profileDogName" aria-live="polite"></p>
      <p class="hint" style="text-align:center">Tip: Click the photo to set or change it for the currently selected dog.</p>
    </section>

    <!-- Entries -->
    <section class="card" id="entriesCard">
      <div class="row wrap between">
        <h2 id="entriesTitle" style="margin:0">Entries</h2>
        <div class="row wrap" id="entriesControls">
          <label>From <input type="date" id="filterFrom"></label>
          <label>To <input type="date" id="filterTo"></label>
          <input type="text" id="filterOwner" placeholder="Owner contains…">
          <select id="sortSelect" title="Sort">
            <option value="date_desc">Newest first</option>
            <option value="date_asc">Oldest first</option>
            <option value="weight_desc">Heaviest first</option>
            <option value="weight_asc">Lightest first</option>
          </select>
          <button id="clearFiltersBtn" title="Clear filters">Clear</button>
          <button id="printBtn" title="Print summary">Print</button>
          <button id="downloadZipBtn" title="Download backup ZIP">Download ZIP</button>
        </div>
      </div>

      <div class="tableWrap" style="max-height:400px;overflow:auto">
        <table id="entriesTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>Owner</th>
              <th>Breed</th>
              <th>Weight (kg)</th>
              <th>Notes</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="entriesBody"></tbody>
        </table>
      </div>
      <p class="hint" id="noEntriesHint" hidden>No entries yet — add a weight below.</p>
    </section>

    <!-- Dogs -->
    <section class="card">
      <h2>Dogs</h2>
      <div class="row" style="flex-wrap:wrap;gap:10px">
        <label for="dogSelect">Select dog</label>
        <select id="dogSelect"></select>
        <button id="deleteDogBtn" type="button" class="danger">Delete Dog</button>
        <button id="openDogModalBtn" type="button">Add New Dog</button>
      </div>
      <p class="hint">Tip: The selector shows “Dog Name — Owner (Breed)”.</p>
    </section>

    <!-- Add a measurement -->
    <section class="card">
      <h2>Add Weight</h2>
      <div class="grid2">
        <div class="row">
          <label for="dtInput">Date</label>
          <input id="dtInput" type="date" />
        </div>
        <div class="row">
          <label for="weightInput">Weight (kg)</label>
          <input id="weightInput" type="number" inputmode="decimal" step="0.01" placeholder="e.g. 21.30" />
        </div>
      </div>
      <div class="row">
        <label for="notesInput">Notes (optional)</label>
        <input id="notesInput" type="text" placeholder="e.g. after dinner / vet scale" />
      </div>
      <button id="addEntryBtn">Add Entry</button>
    </section>

    <!-- Trend -->
    <section class="card">
      <h2>Trend</h2>
      <div class="tableWrap">
        <canvas id="chart" style="width:100%;height:260px;"></canvas>
      </div>
      <p class="hint">Shows the selected dog’s weights over time.</p>
    </section>

    <!-- Data & Export -->
    <section class="card">
      <h2>Data & Export</h2>
      <div class="wrap">
        <button id="exportCsvBtn">Export CSV (selected dog)</button>
        <button id="exportAllCsvBtn">Export CSV (all dogs)</button>
        <button id="backupJsonBtn">Backup (JSON)</button>
        <label class="fileLabel">
          Restore (JSON)
          <input id="restoreJsonInput" type="file" accept="application/json" />
        </label>
        <button id="clearAllBtn" class="danger" title="Remove ALL data from this device">Clear ALL Data</button>
        <button id="installBtn" style="margin-left:auto">Install App</button>
      </div>
      <p class="hint">Data is stored on this device only. Use Backup/Restore to move between devices.</p>
    </section>

    <!-- About & Privacy -->
    <section class="card" style="text-align:center">
      <button id="aboutBtn">About & Privacy</button>
    </section>

    <!-- ===== Modals ===== -->
    <div id="dogModal" class="modal" hidden>
      <div class="modal-card">
        <h3>Add New Dog</h3>
        <div class="row"><label style="min-width:120px">Dog name</label><input id="dogNameInput" type="text" placeholder="e.g. Raq"></div>
        <div class="row"><label style="min-width:120px">Owner surname</label><input id="dogOwnerInput" type="text" placeholder="e.g. Yoxall"></div>
        <div class="row"><label style="min-width:120px">Breed</label><input id="dogBreedInput" type="text" placeholder="e.g. Border Collie"></div>
        <div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end">
          <button id="dogCancelBtn" type="button">Cancel</button>
          <button id="dogSaveBtn" type="button">Save Dog</button>
        </div>
      </div>
    </div>

    <div id="editModal" class="modal" hidden>
      <div class="modal-card">
        <h3>Edit Entry</h3>
        <div class="row"><label style="min-width:120px">Date</label><input id="editDate" type="date"></div>
        <div class="row"><label style="min-width:120px">Weight (kg)</label><input id="editWeight" type="number" inputmode="decimal" step="0.01"></div>
        <div class="row"><label style="min-width:120px">Notes</label><input id="editNotes" type="text" placeholder=""></div>
        <div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end">
          <button id="editCancel" type="button">Cancel</button>
          <button id="editSave" type="button">Save</button>
        </div>
      </div>
    </div>

    <div id="confirmModal" class="confirm-modal" hidden>
      <div class="confirm-card">
        <h3>Delete dog?</h3>
        <p>Are you sure you want to delete <strong id="confirmDogName">this dog</strong> and <em>all of its entries</em> on this device?</p>
        <div class="confirm-actions">
          <button id="confirmCancelBtn">Cancel</button>
          <button id="confirmDeleteBtn" class="danger">Delete</button>
        </div>
      </div>
    </div>

    <div id="aboutModal" class="modal" hidden>
      <div class="modal-card">
        <h3>About & Privacy</h3>
        <p><strong>Dog Weight Tracker</strong> stores all data <em>on this device only</em> (LocalStorage). Nothing is sent to a server.</p>
        <p>To remove data, use <em>Clear ALL Data</em> on this device.</p>
        <div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end">
          <button id="aboutClose">Close</button>
        </div>
      </div>
    </div>

  </main>

  <footer>
    <p>Offline-capable PWA. Made by you ✨</p>
  </footer>

  <!-- SW + App -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js').catch(console.error);
      });
    }
  </script>
  <!-- bump to v=30 -->
  <script src="script.js?v=30"></script>
</body>
</html>
